<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sendly — Simple File Send</title>
<link rel="icon" href="data:," />
<style>
:root{
  --bg: #0f1115;
  --card: #181b22;
  --muted: #a6adbb;
  --text: #e6e9ef;
  --accent: #7c5cff;
  --accent-2:#59e1ff;
  --danger:#ff5c7a;
  --ok:#38d39f;
  --radius: 20px;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,Noto Sans;
  background: radial-gradient(1200px 600px at 0% 0%, rgba(124,92,255,.15), transparent 40%), radial-gradient(900px 500px at 100% 0%, rgba(89,225,255,.12), transparent 45%), var(--bg);
  color:var(--text); display:flex; align-items:center; justify-content:center; padding:32px;
}
.wrap{width:min(980px, 100%);}
header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:24px}
.brand{display:flex; align-items:center; gap:12px}
.brand .dot{width:14px; height:14px; border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent-2)); box-shadow:0 0 18px rgba(124,92,255,.7)}
.brand h1{font-size:18px; margin:0; letter-spacing:.3px}
.card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow); border-radius:var(--radius); padding:20px}
.grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:18px}
@media (max-width: 900px){ .grid{grid-template-columns:1fr} }
.drop{
  background:var(--card);
  border-radius:var(--radius);
  border:1.5px dashed rgba(255,255,255,.18);
  padding:28px; text-align:center; transition:.25s ease; cursor:pointer; position:relative; overflow:hidden;
  min-height:260px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px
}
.drop.dragover{ border-color:var(--accent); box-shadow:0 0 0 4px rgba(124,92,255,.18) inset }
.drop input{ display:none }
.drop .big{font-size:18px; font-weight:600}
.drop .small{color:var(--muted)}
.controls{background:var(--card); border-radius:var(--radius); border:1px solid rgba(255,255,255,.08); padding:18px; display:grid; gap:14px}
label{font-size:13px; color:var(--muted)}
select, input[type="text"]{
  width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:#12151b; color:var(--text); outline:none
}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 16px; border:none; color:white; border-radius:14px; cursor:pointer; transition:.25s ease; font-weight:600
}
.btn.primary{ background:linear-gradient(135deg,var(--accent),var(--accent-2)) }
.btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,.16) }
.btn:disabled{ opacity:.65; cursor:not-allowed }
.list{margin-top:14px; display:grid; gap:10px; max-height:210px; overflow:auto; padding-right:2px}
.item{display:flex; align-items:center; gap:12px; background:rgba(255,255,255,.04); padding:10px 12px; border:1px solid rgba(255,255,255,.08); border-radius:12px}
.item .name{flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.item .meta{color:var(--muted); font-size:12px}
.progress{height:10px; width:100%; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
.bar{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); transition: width .2s ease}
.result{display:none; margin-top:14px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; gap:10px}
.result.show{display:grid}
.linkbox{display:flex; gap:10px}
.linkbox textarea{flex:1; min-height:90px; resize:vertical; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:#12151b; color:var(--text);}
.muted{color:var(--muted)}
footer{margin-top:24px; text-align:center; color:var(--muted); font-size:12px}
a{color:#b8c7ff}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="dot" aria-hidden="true"></div>
      <h1>Sendly</h1>
    </div>
    <div class="muted">No account. Just send files.</div>
  </header>

  <div class="card">
    <div class="grid">
      <div>
        <div id="drop" class="drop" tabindex="0">
          <input id="file-input" type="file" multiple />
          <div class="big">Drag & drop files here</div>
          <div class="small">or click to browse</div>
        </div>
        <div class="list" id="file-list"></div>
      </div>

      <div class="controls">
        <div>
          <label for="expiry">Link expires</label>
          <select id="expiry">
            <option value="1">1 day</option>
            <option value="7" selected>7 days</option>
            <option value="30">30 days</option>
          </select>
        </div>
        <div>
          <label for="note">Message (optional)</label>
          <input id="note" type="text" placeholder="A little note for the recipient" />
        </div>
        <div>
          <button id="btn-upload" class="btn primary" disabled>Create link</button>
          <div class="progress" style="margin-top:10px"><div class="bar" id="bar"></div></div>
          <div id="status" class="muted" style="margin-top:8px"></div>
        </div>
        <div id="result" class="result">
          <div class="muted">Your share link(s)</div>
          <div class="linkbox">
            <textarea id="share-links" readonly></textarea>
            <button id="btn-copy" class="btn ghost">Copy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <strong>Share anything. Anywhere. Instantly.</strong> © <span id="year"></span>
  </footer>
</div>

<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// ---------- CONFIG ----------
const SUPABASE_URL = "https://aahhaznwhejtjydnyaxd.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  + "PrlyZ4ZJ-rAwQQJfWMk8Xrn-w6vjeyle7Jl_mQJ94O4"; 
const BUCKET = "uploads";
// --------------------------

const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const drop = document.getElementById('drop');
const fileInput = document.getElementById('file-input');
const fileList = document.getElementById('file-list');
const btnUpload = document.getElementById('btn-upload');
const bar = document.getElementById('bar');
const status = document.getElementById('status');
const result = document.getElementById('result');
const shareLinks = document.getElementById('share-links');
const btnCopy = document.getElementById('btn-copy');

const state = { files: [], totalBytes: 0 };

function fmtBytes(bytes){
  if(bytes===0) return '0 B';
  const k = 1024; const sizes = ['B','KB','MB','GB','TB'];
  const i = Math.floor(Math.log(bytes)/Math.log(k));
  return (bytes/Math.pow(k,i)).toFixed(2)+' '+sizes[i];
}

function updateList(){
  fileList.innerHTML=''; let total=0;
  state.files.forEach(f=>total+=f.size); state.totalBytes=total;
  btnUpload.disabled=state.files.length===0;
  state.files.forEach(f=>{
    const row=document.createElement('div'); row.className='item';
    row.innerHTML=`<div class="name">${f.name}</div><div class="meta">${fmtBytes(f.size)}</div><button class="btn ghost btn-remove">Remove</button>`;
    row.querySelector('.btn-remove').onclick=()=>{state.files=state.files.filter(x=>x!==f); updateList();};
    fileList.appendChild(row);
  });
  if(state.files.length>0){
    const totalRow=document.createElement('div'); totalRow.className='item';
    totalRow.innerHTML=`<div class="name"><strong>${state.files.length}</strong> file(s) selected</div><div class="meta">Total ${fmtBytes(total)}</div>`;
    fileList.appendChild(totalRow);
  }
}

// Drag/drop events
drop.addEventListener('click',()=>fileInput.click());
drop.addEventListener('dragover',e=>{ e.preventDefault(); drop.classList.add('dragover'); });
drop.addEventListener('dragleave',()=>drop.classList.remove('dragover'));
drop.addEventListener('drop', e=>{ e.preventDefault(); drop.classList.remove('dragover'); state.files.push(...e.dataTransfer.files); updateList(); });
fileInput.addEventListener('change', ()=>{ state.files.push(...fileInput.files); fileInput.value=''; updateList(); });

// Upload to Supabase + create signed URLs
btnUpload.addEventListener('click', async ()=>{
  const days=parseInt(document.getElementById('expiry').value,10);
  const note=document.getElementById('note').value.trim();
  if(state.files.length===0) return;
  const transferId=crypto.randomUUID();
  const folder=`transfers/${transferId}`;
  bar.style.width='0%'; status.textContent='Uploading…'; btnUpload.disabled=true; shareLinks.value='';

  let uploadedBytes=0; const links=[];
  for(const file of state.files){
    const path=`${folder}/${Date.now()}-${file.name}`;
    const { error: upErr } = await client.storage.from(BUCKET).upload(path, file, { upsert:false });
    if(upErr){ console.error(upErr); status.textContent='Upload failed. Check bucket & policies.'; btnUpload.disabled=false; return; }

    const seconds=days*24*60*60;
    const { data: signed, error: signErr } = await client.storage.from(BUCKET).createSignedUrl(path, seconds);
    if(signErr){ console.error(signErr); status.textContent='Could not create link.'; btnUpload.disabled=false; return; }

    links.push(note?`${signed.signedUrl}#note=${encodeURIComponent(note)}`:signed.signedUrl);
    uploadedBytes+=file.size;
    const pct=Math.floor((uploadedBytes/state.totalBytes)*100);
    bar.style.width=Math.min(pct,100)+'%';
  }

  status.textContent=`Done! Generated ${links.length} link(s).`;
  result.classList.add('show'); shareLinks.value=links.join('\n');
  state.files=[]; updateList(); btnUpload.disabled=false;
});

btnCopy.addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(shareLinks.value); btnCopy.textContent='Copied'; setTimeout(()=>btnCopy.textContent='Copy',1200); }catch{}
});

document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>


